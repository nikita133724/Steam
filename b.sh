#!/bin/bash

set -e

# ---------------------------
# 1. Убиваем Ollama и ngrok
# ---------------------------
echo "Останавливаем Ollama и ngrok..."
pkill -f "ollama serve" || echo "Ollama не запущен"
pkill -f "ngrok" || echo "ngrok не запущен"

# ---------------------------
# 2. Чистим рабочую папку, кроме .git
# ---------------------------
echo "Очищаем рабочую папку Codespace..."
shopt -s extglob
rm -rf !( .git )  # удаляет всё кроме .git
shopt -u extglob

# ---------------------------
# 3. Подтягиваем свежие файлы с репозитория
# ---------------------------
echo "Подтягиваем данные с репозитория..."
git reset --hard HEAD
git pull

# ---------------------------
# 4. Запуск run.sh
# ---------------------------
echo "Запускаем run.sh для установки Ollama и ngrok..."
chmod +x a.sh
./a.sh
