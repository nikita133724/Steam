# БОТ САХАРОК — Инструкция по установке

## Структура файлов

```
saharok_bot/
├── main.py          — точка входа (запускать это)
├── bot.py           — главный цикл чтения/ответов
├── brain.py         — все запросы к ИИ
├── database.py      — база данных и память
├── embeddings.py    — векторная память
├── telegram_bot.py  — управление через Telegram
├── maintenance.py   — запускать раз в неделю
├── config.py        — ВСЕ НАСТРОЙКИ ЗДЕСЬ
└── requirements.txt
```

## Установка (на сервере по SSH)

### 1. Установить зависимости

```bash
pip install torch --index-url https://download.pytorch.org/whl/cpu && pip install -r requirements.txt
```

### 2. Настроить config.py

Открыть `config.py` и заполнить:

- `CHAT_JWT_TOKEN` — твой JWT токен с сайта
- `TELEGRAM_BOT_TOKEN` — токен от @BotFather
- `TELEGRAM_MY_ID` — твой Telegram ID (узнать через @userinfobot)

### 3. Первый запуск

```bash
python main.py
```

При первом запуске:

- Создастся база данных `saharok_memory.db`
- Скачается модель эмбеддингов (~200MB, один раз)
- Бот войдёт в режим наблюдения (молчит, собирает данные)
- После 500 сообщений автоматически перейдёт в активный режим

### 4. Запуск в фоне (чтобы не падал при закрытии SSH)

```bash
screen -S saharok
python main.py
# Ctrl+A, D — выйти из screen не останавливая бота
# screen -r saharok — вернуться
```

Или через nohup:

```bash
nohup python main.py > bot.log 2>&1 &
```

## Обслуживание — полностью автоматическое

Ничего настраивать не нужно. Бот сам раз в 7 дней в фоновом режиме:

- Архивирует старые сообщения (старше 4 месяцев сжимаются в портрет)
- Создаёт краткие портреты пользователей из их истории
- Не требует cron, консоли или ручного запуска

Файл `maintenance.py` можно запустить вручную если хочешь сделать это прямо сейчас:

```bash
python maintenance.py
```

Но это необязательно — бот справится сам.

## Управление через Telegram

Напиши своему боту в Telegram:

- `расскажи` — отчёт за последние 24 часа
- `/user никнейм` — профиль пользователя
- `/note никнейм текст` — добавить заметку
- `/wrong неправильно | правильно` — поправить бота

## Обновление JWT токена

Когда токен истечёт — просто обнови `CHAT_JWT_TOKEN` в config.py и перезапусти бота.

## Что означает “фаза наблюдения”

Первые ~500 сообщений бот молчит и только изучает чат.
Это нужно чтобы он знал кто есть кто прежде чем начать писать.
Порог можно изменить в `bot.py` → `OBSERVATION_THRESHOLD`